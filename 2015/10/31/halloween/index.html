<!DOCTYPE html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><script type=text/javascript>var host="upclinux.github.io";host==window.location.host&&"https:"!=window.location.protocol&&(window.location.protocol="https")</script><title>万圣夜快乐</title><meta name=description content=今天是万圣夜（Halloween），正好也是社团文化节晚会。大家肯定都知道，其实我们是不太关心节目的，而且协会缺少妹子，演不出什么好节目，所以我们临时决定，在晚会上搞了一个“不给糖就捣蛋:jack_o_lantern:”（Trick-or-theat）的活动。><link rel=stylesheet href=/css/main.css><link rel=stylesheet type=text/css href=/css/font-awesome.min.css><link rel=canonical href=https://upclinux.github.io/2015/10/31/halloween/ ><link type=application/atom+xml rel=alternate href=https://upclinux.github.io/feed.xml title="UPC Linux"><script type=text/javascript src=/js/jquery-1.11.3.min.js></script><script type=text/javascript src=/js/bootstrap.min.js></script><script type=text/javascript src=/js/index.js></script></head><body><header><nav class="navbar navbar-default"><div class=container><div class=navbar-header><button type=button class="navbar-toggle navbar-toggle-left collapsed" id=toggle-sidebar data-toggle=sidebar data-target=#sidebar-mobile><span class=sr-only>Toggle navigation </span><span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand href=/ >UPC Linux</a></div><div id=navbar class="collapse navbar-collapse"><ul class="nav navbar-nav navbar-right"><li><a href=/ data-toggle=tooltip data-placement=bottom title=首页><i class="fa fa-home"></i></a></li><li class=dropdown><a href=# class=dropdown-toggle data-toggle=dropdown role=button aria-expanded=true data-placement=bottom title=分类><i class="fa fa-th-list"></i> <span class=caret></span></a><ul class=dropdown-menu role=menu><li><a href="/categories/?c=All"><span class=badge style=float:right>15 </span>全部文章</a></li><li class=divider></li><li class=dropdown-header>列表</li><li><a href="/categories/?c=%E6%B4%BB%E5%8A%A8"><span class=badge style=float:right>4 </span>活动</a></li><li><a href="/categories/?c=%E7%A4%BE%E5%9B%A2%E5%B7%A5%E4%BD%9C"><span class=badge style=float:right>5 </span>社团工作</a></li><li><a href="/categories/?c=%E6%9D%82%E8%B0%88"><span class=badge style=float:right>3 </span>杂谈</a></li><li><a href="/categories/?c=%E7%B3%BB%E7%BB%9F%E7%BB%B4%E6%8A%A4"><span class=badge style=float:right>1 </span>系统维护</a></li><li><a href="/categories/?c=%E5%81%9A%E7%BD%91%E7%AB%99"><span class=badge style=float:right>2 </span>做网站</a></li></ul></li><li><a href=/tags/ data-toggle=tooltip data-placement=bottom title=标签><i class="fa fa-tags"></i></a></li><li><a href=/archive/ data-toggle=tooltip data-placement=bottom title=归档><i class="fa fa-archive"></i></a></li><li><a href=/about/ data-toggle=tooltip data-placement=bottom title=关于><i class="fa fa-graduation-cap"></i></a></li><li><a href=https://github.com/upclinux/upclinux.github.io data-toggle=tooltip data-placement=bottom title=源代码><i class="fa fa-code"></i></a></li><li><a href=/feed.xml data-toggle=tooltip data-placement=bottom title=RSS><i class="fa fa-rss"></i></a></li></ul></div></div></nav></header><div class=jumbotron><div class=container><h1 class=post-title id=post-title><a href=/ >万圣夜快乐</a></h1><p><span class="glyphicon glyphicon-calendar"></span> 2015-10-31     <span class="glyphicon glyphicon-user"></span> vjudge1     <span class="glyphicon glyphicon-th-list"></span> <a href="/categories/?c=%E6%B4%BB%E5%8A%A8">活动 </a>    <span class="glyphicon glyphicon-tags"></span>   <a href=/tags/#tag-XSS>XSS</a></p></div></div><div id=main class=container><div class=row><div class=col-md-8 role=main><article class=article><ul id=markdown-toc><li><a href=#trick-or-treat id=markdown-toc-trick-or-treat>Trick-or-treat!</a></li><li><a href=#%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88 id=markdown-toc-发生了什么>发生了什么</a><ul><li><a href=#%E5%BE%AE%E4%BF%A1%E5%A2%99 id=markdown-toc-微信墙>微信墙</a></li><li><a href=#xss id=markdown-toc-xss>XSS</a></li></ul></li><li><a href=#%E5%8F%A6%E4%B8%80%E4%B8%AA-trick-or-theat id=markdown-toc-另一个-trick-or-theat>另一个 Trick-or-theat</a></li><li><a href=#%E7%BB%93%E8%AE%BA id=markdown-toc-结论>结论</a></li></ul><p>今天是<a href=https://zh.wikipedia.org/wiki/%E4%B8%87%E5%9C%A3%E5%A4%9C>万圣夜</a>（Halloween），正好也是社团文化节晚会。</p><p>大家肯定都知道，其实我们是不太关心节目的，而且协会缺少妹子，演不出什么好节目，所以我们临时决定，在晚会上搞了一个“不给糖就捣蛋<img class=emoji title=:jack_o_lantern: alt=:jack_o_lantern: src=https://github.githubassets.com/images/icons/emoji/unicode/1f383.png height=20 width=20>”（Trick-or-theat）的活动。</p><div class="callout callout-warning"><h4 id=今天不是万圣节>今天不是万圣节</h4><p>稍微纠正一下，10月31日并不是万圣节（All Saints’ Day），而是万圣夜（Halloween）。就像12月24日不是圣诞节（Christmas Day）而是圣诞夜（Christmas Eve）……<span class=blackout>其实都是淘宝搞促销的借口而已</span></p></div><p><img src=/img/2015-10-31-halloween/1.jpg alt=晚会现场></p><p><small>这就是晚会现场，虽然我们没有人上台演出。</small></p><h1 id=trick-or-treat>Trick-or-treat!</h1><p>我们协会并没有上台演出（因为需要提前排练），而是在舞台两边的微信墙演出——就是拿微信关注“社团石大”公众号，然后在活动期间给公众号发文字，你的文字就能显示到微信墙上，从而参与互动。就是下图——</p><p><img src=/img/2015-10-31-halloween/2.jpg alt=微信墙></p><p><small>那个大法风格文字不是我们的节目。</small></p><p>节目开始——我们的演员，向微信墙，发了一条信息：</p><figure class=highlight><pre><code class=language-html data-lang=html>萌萌哒<span class=nt>&lt;script&gt;</span><span class=k>while</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span><span class=nt>&lt;/script&gt;</span></code></pre></figure><p>节目很短，一下子就演完了<img class=emoji title=:ghost: alt=:ghost: src=https://github.githubassets.com/images/icons/emoji/unicode/1f47b.png height=20 width=20>。</p><p>由于我们的准备不太充分，所以节目真的不精彩。下回我们会好好准备……</p><div class="callout callout-primary"><h4 id=严肃点>严肃点</h4><p>这也叫节目？</p><p>难道你没仔细看一下演员到底发了什么吗？<span class=blackout>我们的演员反映说，大屏幕黑了3分钟，投影仪（其实应该是操作投影仪的人）一直在重启，最后重新打开网页才上去……</span></p></div><h1 id=发生了什么>发生了什么</h1><h2 id=微信墙>微信墙</h2><p>我们的节目虽然很短，但是有一个响亮的名字——<a href=https://zh.wikipedia.org/wiki/%E8%B7%A8%E7%B6%B2%E7%AB%99%E6%8C%87%E4%BB%A4%E7%A2%BC>XSS（跨站脚本攻击）</a>。</p><p>首先谈谈微信墙。</p><p>微信实在是火得不得了，各种营销互动拉票<span class=blackout>集赞骗人</span>活动都用微信，简直是腾讯的新帝国！因为微信提供了众多开发者接口（虽然不一定都给<span class=blackout>屌丝</span>开放），但是在大家都不愿意安装新 APP 的情况下，使用微信作为一个轻 APP 实在是太划算了。</p><p>微信墙的原理就很简单了——一个经过设计狮精心制作的网页，后台 PHP+MySQL，隔几秒钟就把服务器里的留言显示出来（用 AJAX 技术避免浏览器的“刷新”）。至于微信墙做得怎么样，基本上取决于设计狮的水平。<span class=blackout>后端PHP+前端AJAX都普及到泛滥了，所以随便找个人都能把后台写出来。</span>服务器的数据哪儿来呢？因为微信有接口，所以按照疼讯的接口文档编程就行了。</p><p>因为微信太火了，所以事实上根本都用不着编程——百度上一搜一大把。稍微懂点技术就行，如果拿 Windows 当服务器，甚至都不用敲命令<img class=emoji title=:smirk: alt=:smirk: src=https://github.githubassets.com/images/icons/emoji/unicode/1f60f.png height=20 width=20>。</p><h2 id=xss>XSS</h2><p>接着谈谈我们的“节目”。</p><p>XSS 有很多种形式。精心构造的 XSS 可以达到破坏或窃取数据的目的。当然，作为一个晚会的“节目”，我们就只写了一个最简单的 while(1)。（其实演员还不知道这个东西是啥呢！）</p><p>因为微信墙后台太简单了，而且没有哪个正常人会像孙悟空那样大闹<s>天宫</s>晚会（特意安排的不算），所以编程的人肯定没想到有人会在万圣节前夜捣蛋——</p><p>微信是疼讯搞的，我们认为它没有漏洞（至少跟微信墙相比）。它会把我们发的内容原封不动地交给微信墙服务器。作为一个网站，微信墙可能会用以下方式显示观众留言：</p><figure class=highlight><pre><code class=language-php data-lang=php><span class=cp>&lt;?php</span>
    <span class=c1>// 从服务器（数据库）获取留言</span>
    <span class=mf>...</span>
    <span class=nv>$row</span> <span class=o>=</span> <span class=nb>mysql_query</span><span class=p>(</span><span class=nv>$sql</span><span class=p>);</span>
    <span class=nv>$user</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
    <span class=nv>$message</span> <span class=o>=</span> <span class=nv>$row</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
    <span class=mf>...</span>
<span class=cp>?&gt;</span>
...
<span class=c>&lt;!-- 显示用户留言（头像昵称什么的，略） --&gt;</span>
<span class=nt>&lt;li&gt;</span><span class=cp>&lt;?php</span> <span class=k>echo</span> <span class=nv>$message</span><span class=p>;</span> <span class=cp>?&gt;</span><span class=nt>&lt;/li&gt;</span></code></pre></figure><p>他们很可能直接用 echo 语句把观众留言输出。</p><p>PHP 的 echo 并不进行任何过滤，所以你发<code class="language-plaintext highlighter-rouge">萌萌哒</code>的时候会显示<code class="language-plaintext highlighter-rouge">萌萌哒</code>三个字；发<code class="language-plaintext highlighter-rouge">萌萌哒&lt;script&gt;while(1);&lt;/script&gt;</code>的时候也会把这堆乱七八糟的东西同时输出，只不过，后面<code class="language-plaintext highlighter-rouge">script</code>包围的东西是一个合法的 HTML 标签，所以<strong>浏览器会执行这段代码</strong>。于是……浏览器卡死了。</p><p>XSS 就是这样。一个攻击者试图找到网站的漏洞，通过发送精心构造的数据，使浏览器可以执行一段代码。结果就是，其他人在浏览这些页面的时候，浏览器执行了这段代码，……<span class=blackout>实施破坏，或者窃取隐私，或者植入病毒</span></p><p>XSS 的防范也是个技术活。原则很简单，<strong>不要信任任何来自用户的数据</strong>，因此在输出之前对特殊字符进行过滤是最有效的方法。</p><div class="callout callout-primary"><h4 id=高级主题>高级主题</h4><p>如果出于功能需要，不能过滤所有 HTML 标签，可以看一下百度Web前端开发部的<a href=http://fex.baidu.com/blog/2014/06/xss-frontend-firewall-1/ >相关文章</a>。他们试图站在前端的角度，在不过滤 HTML 标签的情况下阻止恶意元素的产生。</p></div><h1 id=另一个-trick-or-theat>另一个 Trick-or-theat</h1><p>既然一个简单的脚本就把微信墙搞垮了，那么他们微信墙后台的密码肯定是<code class="language-plaintext highlighter-rouge">' or 'a'='a</code>。不信可以试试。</p><p>这是我们要演的另一个节目，节目的名字是 <a href=https://zh.wikipedia.org/wiki/SQL%E8%B3%87%E6%96%99%E9%9A%B1%E7%A2%BC%E6%94%BB%E6%93%8A>SQL 注入</a>，只不过今天太匆忙没做彩排。等以后再有晚会的时候，我们可能就会派人演出，到时候欢迎大家捧场<img class=emoji title=:smirk: alt=:smirk: src=https://github.githubassets.com/images/icons/emoji/unicode/1f60f.png height=20 width=20>。</p><h1 id=结论>结论</h1><p>现在处处都在强调“安全生产”，甚至<a href=http://news.sina.com.cn/s/p/2014-08-05/115130633427.shtml>有一个工地</a>里面都写着<code class="language-plaintext highlighter-rouge">亲爱的工友们：在外打工，注意安全，一旦发生事故：别人睡你媳妇，打你孩子，花你的抚恤金！打工安全，为你自己。</code></p><p>所以，作为给人打工的IT农民工——码农，开发应用的时候怎能不注意安全呢？<span class=blackout>虽然很多码农没有媳妇孩子和抚恤金</span></p></article><div class=text-right><ul class=sharelist><li><a href=# class=share data-target=weibo data-toggle=tooltip title=分享到新浪微博><i class="fa fa-weibo"></i></a></li><li><a href=# class=share data-target=linkedin data-toggle=tooltip title=分享到LinkedIn><i class="fa fa-linkedin-square"></i></a></li><li><a href=# class=share data-target=facebook data-toggle=tooltip title=分享到Facebook><i class="fa fa-facebook-square"></i></a></li><li><a href=# class=share data-target=twitter data-toggle=tooltip title=分享到Twitter><i class="fa fa-twitter-square"></i></a></li><li><span class=text-muted>分享本文：</span></li></ul><script src=/js/share.js></script></div><br class=clear><div class="post-area post comment"><div id=disqus_thread></div><script type=text/javascript>var disqus_shortname="upclinux";(()=>{var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript></div><br class=clear></div><div id=content class="col-sm-4 hidden-xs hidden-sm"><ul class=nav id=content-ul></ul></div></div></div><script type=text/javascript src=//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js></script><script type=text/javascript>anchors.options.placement="left",anchors.add("article h1,h2,h3,h4")</script><div id=top data-toggle=tooltip data-placement=left title=回到顶部><a href=javascript:;><div class=arrow></div><div class=stick></div></a></div><footer class=site-footer id=footer><div class=container><ol class=footer-list><li><a href=/about/ >关于</a></li><li><a href=https://upclinux.github.io/intro/ >入门指引</a></li></ol><ol class=social-media-list><li><a href=mailto:upclinux@163.com data-toggle=tooltip data-placement=top title=Email><i class="fa fa-envelope"></i></a></li><li><a href=https://github.com/upclinux data-toggle=tooltip data-placement=top title=GitHub><i class="fa fa-github"></i></a></li><li><a href="http://shang.qq.com/wpa/qunwpa?idkey=e47c6b546d3373c09f7eaa8d4173728a513975ed2d0ec20106e83cfb11a3bf08" target=_blank data-toggle=tooltip data-placement=top title=QQ群><i class="fa fa-qq"></i></a></li></ol><br class=clear><div class=footnote><a rel=license href=http://creativecommons.org/licenses/by-nc-sa/4.0/ ><img alt=知识共享许可协议 style=border-width:0 src=https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png></a>by <a href=https://github.com/vjudge1>李思洋</a></div></div></footer><div id=sidebar-mobile class=sidebar><div class=sb-mask></div><div class=sb-body><div class=sb-title><form action=/search/ id=sb_searchform><input type=search placeholder=搜索 class=sb-searchbox name=s> <a href=javascript:document.forms.sb_searchform.submit(); class=sb-searchbutton><i class="fa fa-search"></i></a></form></div><div class=sb-container><div class=sb-content id=sb-content><div class=icons-list><a href=/archive/ data-toggle=tooltip data-placement=bottom title=归档><i class="fa fa-archive"></i> </a><a href=/about/ data-toggle=tooltip data-placement=bottom title=关于><i class="fa fa-graduation-cap"></i> </a><a href=https://github.com/upclinux/upclinux.github.io data-toggle=tooltip data-placement=bottom title=源代码><i class="fa fa-code"></i> </a><a href=/feed.xml data-toggle=tooltip data-placement=bottom title=RSS><i class="fa fa-rss"></i></a></div><div id=contents-sidebar class=contents style=display:none><h4 class=page-header><i class="fa fa-list-ol"></i> 目录</h4><ul class=contents-list id=contents-sidebar-ul></ul></div><h4 class=page-header><i class="fa fa-th-list"></i> 分类</h4><div class=categories-list><a class=item href="/categories/?c=%E5%85%A8%E9%83%A8%E6%96%87%E7%AB%A0" data-cate=全部文章>全部文章 <span class=badge>15 </span></a><a class=item href="/categories/?c=%E6%B4%BB%E5%8A%A8" data-cate=活动>活动 <span class=badge>4 </span></a><a class=item href="/categories/?c=%E7%A4%BE%E5%9B%A2%E5%B7%A5%E4%BD%9C" data-cate=社团工作>社团工作 <span class=badge>5 </span></a><a class=item href="/categories/?c=%E6%9D%82%E8%B0%88" data-cate=杂谈>杂谈 <span class=badge>3 </span></a><a class=item href="/categories/?c=%E7%B3%BB%E7%BB%9F%E7%BB%B4%E6%8A%A4" data-cate=系统维护>系统维护 <span class=badge>1 </span></a><a class=item href="/categories/?c=%E5%81%9A%E7%BD%91%E7%AB%99" data-cate=做网站>做网站 <span class=badge>2</span></a></div><h4 class=page-header><i class="fa fa-tags"></i> 标签</h4><div class=tags><ul class=tags-list><li><a href=/tags/#tag-%E5%9B%BE%E4%B9%A6%E9%A6%86 class="btn btn-dark" data-toggle=sidebar data-target=#sidebar-mobile>图书馆 <sup>2</sup></a></li><li><a href=/tags/#tag-%E5%B1%95%E7%A4%BA class="btn btn-dark" data-toggle=sidebar data-target=#sidebar-mobile>展示 <sup>1</sup></a></li><li><a href=/tags/#tag-Linux class="btn btn-dark" data-toggle=sidebar data-target=#sidebar-mobile>Linux <sup>1</sup></a></li><li><a href=/tags/#tag-%E7%A7%91%E5%AD%A6 class="btn btn-dark" data-toggle=sidebar data-target=#sidebar-mobile>科学 <sup>1</sup></a></li><li><a href=/tags/#tag-%E8%AE%B2%E5%BA%A7 class="btn btn-dark" data-toggle=sidebar data-target=#sidebar-mobile>讲座 <sup>2</sup></a></li><li><a href=/tags/#tag-Deepin class="btn btn-dark" data-toggle=sidebar data-target=#sidebar-mobile>Deepin <sup>1</sup></a></li><li><a href=/tags/#tag-Windows class="btn btn-dark" data-toggle=sidebar data-target=#sidebar-mobile>Windows <sup>1</sup></a></li><li><a href=/tags/#tag-UEFI class="btn btn-dark" data-toggle=sidebar data-target=#sidebar-mobile>UEFI <sup>1</sup></a></li><li><a href=/tags/#tag-GitHub class="btn btn-dark" data-toggle=sidebar data-target=#sidebar-mobile>GitHub <sup>2</sup></a></li><li><a href=/tags/#tag-Freemind class="btn btn-dark" data-toggle=sidebar data-target=#sidebar-mobile>Freemind <sup>1</sup></a></li><li><a href=/tags/#tag-UPC class="btn btn-dark" data-toggle=sidebar data-target=#sidebar-mobile>UPC <sup>3</sup></a></li><li><a href=/tags/#tag-%E7%BA%B3%E6%96%B0 class="btn btn-dark" data-toggle=sidebar data-target=#sidebar-mobile>纳新 <sup>2</sup></a></li><li><a href=/tags/#tag-XSS class="btn btn-dark" data-toggle=sidebar data-target=#sidebar-mobile>XSS <sup>1</sup></a></li><li><a href=/tags/#tag-AI class="btn btn-dark" data-toggle=sidebar data-target=#sidebar-mobile>AI <sup>1</sup></a></li></ul></div></div></div></div></div><script type=text/javascript src=/js/sidebar.js></script><div style=display:none><script src="//s11.cnzz.com/z_stat.php?id=1256410622&amp;web_id=1256410622"></script></div></body></html>